<!DOCTYPE html>
<html>
<head>
    <title>测试401错误处理</title>
</head>
<body>
    <h1>测试401错误处理</h1>
    <button onclick="testInvalidToken()">测试无效Token</button>
    <button onclick="clearToken()">清除Token</button>
    <button onclick="checkToken()">检查Token</button>
    <div id="result"></div>

    <script>
        function testInvalidToken() {
            // 设置一个无效的token
            localStorage.setItem('access_token', 'invalid_token_12345');
            
            // 发送请求到节点接口
            fetch('http://localhost:5001/api/v1/nodes', {
                headers: {
                    'Authorization': 'Bearer invalid_token_12345'
                }
            })
            .then(response => {
                if (response.status === 401) {
                    document.getElementById('result').innerHTML = '收到401错误，应该跳转到登录页面';
                    // 清除token并跳转
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('user_info');
                    localStorage.removeItem('current_tenant');
                    window.location.href = '/login';
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('result').innerHTML = JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('result').innerHTML = '错误: ' + error.message;
            });
        }
        
        function clearToken() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('user_info');
            localStorage.removeItem('current_tenant');
            document.getElementById('result').innerHTML = 'Token已清除';
        }
        
        function checkToken() {
            const token = localStorage.getItem('access_token');
            const userInfo = localStorage.getItem('user_info');
            document.getElementById('result').innerHTML = `Token: ${token ? '存在' : '不存在'}<br>UserInfo: ${userInfo ? '存在' : '不存在'}`;
        }
    </script>
</body>
</html>