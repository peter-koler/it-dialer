# 报表模块 SRS（软件需求规格说明书）
## 1. 模块概述
报表模块是 IT-Dialer 网络拨测系统的重要扩展功能，用于对拨测任务产生的数据进行统计、分析与可视化展示。用户可通过报表模块快速了解网络质量与性能趋势，支持对 **TCP、Ping、HTTP、API** 四类拨测任务生成报表。模块支持趋势分析、分布对比、TOP 榜单以及自动化报表订阅，帮助运维人员更高效地进行网络性能评估与问题定位。
---
## 2. 功能需求

### 2.1 报表类型
#### 报表总览（Overview Report）
1.1 总体可用性
各类型任务的成功率（折线图 + 饼图）
可用性 TOP10 任务
1.2 延迟/响应性能对比
TCP 平均连接时间
Ping 平均延迟、丢包率
HTTP 平均响应时间、状态码分布
API 事务成功率、断言通过率
1.3 整体趋势分析
各任务类型成功率趋势
平均响应时间趋势（多折线对比
#### 专项报表（Detailed Reports）
每种拨测类型独立报表：
- **TCP 报表**
  - 成功率趋势图
  - 平均/最大/最小连接时间
  - 超时次数统计
  - TOPN：失败率最高的任务
- **Ping 报表**
  - 平均延迟趋势图
  - 丢包率分布
  - 抖动分析
  - TOPN：延迟最高的任务
- **HTTP 报表**
  - 平均响应时间趋势
  - 首字节时间、下载时间、SSL 握手时间
  - 状态码分布
  - TOPN：响应时间最长的任务
- **API 报表**
  - 事务成功率趋势
  - 断言通过率 vs 失败率
  - 多步骤耗时分解（堆叠柱状图）
  - TOPN：失败次数最多的事务
---
### 2.2 维度与筛选
- 时间范围（自定义、快捷选择 1h/1d/7d/30d）
- 任务类型（TCP / Ping / HTTP / API）
- 任务筛选（任务 ID、任务组）
- 地域/节点（agent_area、agent_id）
- 执行状态（成功 / 失败）

---

### 2.3 数据展示
- 趋势图（折线图展示时间序列）
- 分布图（柱状图展示响应时间/丢包率/状态码分布）
- 饼图（成功率、失败率占比）
- TOP 榜单（如失败率最高的任务、响应时间最长的任务）
---
### 2.4 报表导出
- 导出 PDF、Excel 格式
- 导出内容可定制（时间范围、指标、维度）
- 导出文件包含系统 Logo、时间戳、生成用户信息

---
### 2.5 自动化报表
- 支持日报、周报、月报订阅
- 报表通过邮件
- 可配置推送对象（个人/组织/部门）
---
## 3. 非功能需求

### 3.1 性能需求
- 报表生成时间 ≤ 5 秒（10 万条数据内）
- 支持并发生成 50 份报表
### 3.2 安全需求
- 报表导出仅限授权用户
- 报表接口必须使用 JWT 认证
- 报表订阅配置需加密存储
---
## 4. API 设计
### 4.1 报表管理接口
- `GET /api/v1/reports`  
  获取报表列表（支持分页、任务类型筛选）
- `POST /api/v1/reports/generate`  
  生成报表（传入任务类型、时间范围、指标、维度）
- `GET /api/v1/reports/<id>`  
  获取报表详情（含图表数据与原始统计数据）
- `GET /api/v1/reports/export/<id>?format=pdf|excel`  
  导出报表文件
### 4.2 报表订阅接口
- `POST /api/v1/reports/subscription`  
  创建订阅（任务类型、周期、推送对象）
- `GET /api/v1/reports/subscription`  
  获取订阅列表
- `DELETE /api/v1/reports/subscription/<id>`  
  删除订阅
---
## 5. 前端设计
菜单设计
报表模块（一级菜单）
│
├── 1. 报表总览（二级菜单）
├── 2. 专项报表（二级菜单）
│     ├── 2.1 TCP 报表 （三级菜单）
│     ├── 2.2 Ping 报表（三级菜单）
│     ├── 2.3 HTTP 报表 （三级菜单—）
│     └── 2.4 API 报表 （三级菜单）
### 5.1 页面结构
- **报表总览页**
  - Tab 切换（TCP、Ping、HTTP、API）
  - 快捷时间筛选（1h/1d/7d/30d）
  - 图表联动展示
- **报表详情页**
  - 指标趋势图、分布图、TOP 榜
  - 数据表格可导出
- **订阅配置页**
  - 新建订阅（任务类型、周期、推送渠道）
  - 查看/修改订阅
  - 订阅历史报表记录
### 5.2 前端技术
- 框架：Vue 3 + Ant Design Vue
- 图表：ECharts + AntV/G2Plot
- 导出：前端触发后端生成文件并下载
- 分格：antdesign pro
---
## 6. 数据库设计（扩展表）

### 表：`reports`
| 字段名        | 类型      | 说明                           |
|---------------|-----------|--------------------------------|
| id            | int       | 报表 ID                        |
| type          | varchar   | 报表类型 (tcp/ping/http/api)   |
| task_ids      | json      | 任务 ID 列表                   |
| time_range    | json      | 时间范围                       |
| metrics       | json      | 指标集合                       |
| generate_time | datetime  | 报表生成时间                   |
| file_path     | varchar   | 导出文件路径                   |
### 表：`report_subscriptions`
| 字段名     | 类型      | 说明                                     |
|------------|-----------|------------------------------------------|
| id         | int       | 订阅 ID                                  |
| type       | varchar   | 报表类型                                 |
| task_ids   | json      | 任务 ID 列表                             |
| period     | varchar   | 周期（daily/weekly/monthly）             |
| target     | json      | 推送对象                                 |
| create_time| datetime  | 创建时间                                 |
---

## 7. 模块价值
- 提供可视化的性能数据分析，辅助运维人员快速定位网络问题  
- 支持跨任务、跨地域的对比分析  
- 报表导出与订阅功能，便于运维管理与对外汇报  
- 结合告警系统，形成监控 → 告警 → 报表 → 优化的闭环  
